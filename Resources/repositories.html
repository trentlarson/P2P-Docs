<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Repositories</title>


<style>
.repoRemove {
  display: none;
  cursor: pointer;
}
.repoInfo {
  cursor: pointer;
  vertical-align: 100%;
  display: none;
}
.repoAdd {
  cursor: pointer;
}
.repoAccept {
  visibility: hidden;
  cursor: pointer;
}
.repoRevert {
  visibility: hidden;
  cursor: pointer;
}
</style>

<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
<script type="text/ruby"       src="ruby/settings.rb"></script>


<script type="text/ruby">
  window.p2pdoc_settings = Settings.new(Titanium.Filesystem.getApplicationDataDirectory())
</script>

<script type="text/javascript">
var Ti = {fs: Titanium.Filesystem, api:Titanium.API};

var remove_repo = function(name) {
  return function() {
    if (confirm("This will stop tracking the repository " + name + ", but it will leave all the files.  Are you sure you want to stop tracking it?")) {
alert('about to test');
      window.p2pdoc_settings.test();
alert('about to test in');
      window.p2pdoc_settings.testin();
alert('about to test out');
      window.p2pdoc_settings.testout(name);
alert('about to remove');
      window.p2pdoc_settings.remove_repo(name);
alert('about to save');
      window.p2pdoc_settings.save();
    }
  }
};


$(document).ready(function() {

try {

  var repos = window.p2pdoc_settings.properties().repositories;

  if (repos) {
    var item = $('#repoItem_');
    for (var i = 0; i < repos.length; i++) {
window.p2pdoc_settings.testin();
      var repo = repos[i];

      // create the visual for it
      var addedItem = item.clone();
      addedItem.attr("id", "repoItem_" + repo.name);
      addedItem.insertBefore(item);
      addedItem.find("#repoRemove_").attr("id", "repoRemove_" + repo.name).show();
      addedItem.find("#repoName_")  .attr("id", "repoName_"   + repo.name).show().val(repo.name).width(repo.name.length * 7);
      addedItem.find("#repoPath_")  .attr("id", "repoPath_"   + repo.name).show().val(repo.source_dir).width(repo.source_dir.length * 7);
      addedItem.find("#repoAdd_")   .attr("id", "repoAdd_"    + repo.name).hide();
      addedItem.find("#repoAccept_").attr("id", "repoAccept_" + repo.name).hide();
      addedItem.find("#repoRevert_").attr("id", "repoRevert_" + repo.name).hide();
      // attach methods to the visuals
      addedItem.find("#repoRemove_" + repo.name).click(remove_repo(repo.name));
    }
  }

} catch (e) {
  alert('error: ' + e);
}

$('#repoItem_ #repoAdd_').click(function() {
  var repos = window.p2pdoc_settings.properties().repositories;
  var lastRepo = repos.last();
  window.p2pdoc_settings.add_repo(lastRepo.name+'-2', lastRepo.source_dir+'-2');
  window.p2pdoc_settings.save();
  var repo = repos.last();
  
  // create the visual for it
  var item = $('#repoItem_');
  var addedItem = item.clone();
  addedItem.attr("id", "repoItem_" + repo.name);
  addedItem.insertBefore(item);
  addedItem.find("#repoRemove_").attr("id", "repoRemove_" + repo.name).show();
  addedItem.find("#repoName_")  .attr("id", "repoName_"   + repo.name).show().val(repo.name).width(repo.name.length * 7);
  addedItem.find("#repoPath_")  .attr("id", "repoPath_"   + repo.name).show().val(repo.source_dir).width(repo.source_dir.length * 7);
  addedItem.find("#repoAdd_")   .attr("id", "repoAdd_"    + repo.name).hide();
  addedItem.find("#repoAccept_").attr("id", "repoAccept_" + repo.name).hide();
  addedItem.find("#repoRevert_").attr("id", "repoRevert_" + repo.name).hide();
  // attach methods to the visuals
  addedItem.find("#repoRemove_" + repo.name).click(remove_repo(repo.name));
});

});

</script>
</head>

<body>
<h1>Repositories</h1>

<a href="index.html">Index</a>

<p>
<div id="repoList">
  <div id="repoItem_" class="repoItem">
    <img src="images/button-red-x.png" title="Remove" alt="Remove" id="repoRemove_" class="repoRemove">
    <input type="text" name="name_" id="repoName_" class="repoInfo">
    <input type="text" name="path_" id="repoPath_" class="repoInfo">
    <img src="images/button-green-plus.png" title="Add" alt="Add" id="repoAdd_" class="repoAdd">
    <img src="images/button-green-check.png" title="Accept" alt="Accept" id="repoAccept_" class="repoAccept">
    <img src="images/button-red-back.png" title="Revert" alt="Revert" id="repoRevert_" class="repoRevert">
  </div>
</div>

</body>
</html>
