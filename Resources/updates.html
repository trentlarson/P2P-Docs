<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title></title>

<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.13.custom.min.js"></script>

<link type="text/css" href="css/smoothness/jquery-ui-1.8.13.custom.css" rel="stylesheet"/>

<script type="text/ruby"       src="ruby/settings.rb"></script>
<script type="text/ruby"       src="ruby/updates.rb"></script>

<script type="text/ruby">
  window.p2pdoc_settings = Settings.new(Titanium.Filesystem.getApplicationDataDirectory())
  window.p2pdoc_all_diffs = Updates.all_repo_diffs(window.p2pdoc_settings)
</script>

<script type="text/javascript">

function all_props(the_obj) {
  var str = "";
  for (prop in the_obj) {
    str += prop + " value: "+ the_obj[prop]+"\n";
  }
  return str;
}

var Ti = {fs: Titanium.Filesystem, api:Titanium.API};

$(document).ready(function() {

  try {
    var all_diffs = window.p2pdoc_all_diffs;
    if (all_diffs.length > 0) {

      $('#diff').show();
      $('#same').hide();

      var repoName;
      var repoFileList, repoFile;
      var item = $('#fileList #file_');
      var diffSet;

      for (var repoNum = 0, repoCount = all_diffs.length; repoNum < repoCount; repoNum++) {
        oneRepoDiffs = all_diffs[repoNum];
        repoName = oneRepoDiffs.name;
        repoDiffList = oneRepoDiffs.diffs;
        for (var diffNum = 0, diffCount = repoDiffList.length; diffNum < diffCount; diffNum++) {
          var addedItem = item.clone();
          addedItem.insertBefore(item);
          addedItem.show();
          addedItem.attr("id", "file_" + diffNum);

          diffSet = repoDiffList[diffNum];
          addedItem.find("#repoName_").attr("id", "repoName_" + diffNum).html(repoName);
          addedItem.find("#diffPath_").attr("id", "diffPath_" + diffNum).html(diffSet.path);
          addedItem.find("#diffCount_").attr("id", "diffCount_" + diffNum).html(diffSet.contents.length);
        }
      }
    }

    $("#fileList").accordion({ header: "h3", collapsible: true });

  } catch (e) {
    alert('error: ' + e);
  }

});
</script>
</head>
<body>
<h1>Updates</h1>

<a href="index.html">Index</a>

<h4 id="same">Nothing to see.</h4>
<h4 id="diff" style="display:none;">You've got changes!</h4>

<div id="fileList">
  <div id="file_" style="display:none;">
    <h3>
      <a href="#">
        <span id="repoName_">repo</span>
        <span id="diffPath_">path</span>
        <span id="diffCount_">count</span>
      </a>
    </h3>
    <div>content</div>
  </div>
</div>

</body>
</html>
